(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{435:function(a,e,t){"use strict";t.r(e);var s=t(17),n=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#overview"}},[a._v("Overview")])]),e("li",[e("a",{attrs:{href:"#creating-events"}},[a._v("Creating Events")])]),e("li",[e("a",{attrs:{href:"#creating-campaigns"}},[a._v("Creating Campaigns")])]),e("li",[e("a",{attrs:{href:"#email-templates"}},[a._v("Email Templates")])]),e("li",[e("a",{attrs:{href:"#campaign-processing"}},[a._v("Campaign Processing")])]),e("li",[e("a",{attrs:{href:"#command-and-scheduling"}},[a._v("Command and Scheduling")]),e("ul",[e("li",[e("a",{attrs:{href:"#command-class"}},[a._v("Command Class")])]),e("li",[e("a",{attrs:{href:"#service-provider-scheduling"}},[a._v("Service Provider Scheduling")])])])]),e("li",[e("a",{attrs:{href:"#email-sending-logic"}},[a._v("Email Sending Logic")]),e("ul",[e("li",[e("a",{attrs:{href:"#location"}},[a._v("Location")])]),e("li",[e("a",{attrs:{href:"#method-process"}},[a._v("Method: process()")])]),e("li",[e("a",{attrs:{href:"#method-getpersonsemails"}},[a._v("Method: getPersonsEmails()")])])])]),e("li",[e("a",{attrs:{href:"#queue-and-scheduler-configuration"}},[a._v("Queue and Scheduler Configuration")]),e("ul",[e("li",[e("a",{attrs:{href:"#laravel-queue"}},[a._v("Laravel Queue")])]),e("li",[e("a",{attrs:{href:"#laravel-scheduler"}},[a._v("Laravel Scheduler")])])])])])]),e("p"),a._v(" "),e("h1",{attrs:{id:"events-and-campaigns-developer-documentation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#events-and-campaigns-developer-documentation"}},[a._v("#")]),a._v(" Events and Campaigns - Developer Documentation")]),a._v(" "),e("p",[a._v("Krayin CRM provides an Events and Campaigns feature to facilitate event-based email marketing. This module enables administrators to create events, configure campaigns associated with these events, and automatically send emails to contacts based on configured schedules.")]),a._v(" "),e("p",[a._v("This documentation outlines the steps required to create and manage events and campaigns, and explains the internal command and scheduling logic used to process and send campaign emails.")]),a._v(" "),e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[a._v("#")]),a._v(" Overview")]),a._v(" "),e("p",[a._v("The marketing feature allows campaigns to be triggered based on scheduled events. Each campaign is linked to a specific event and email template. The system automatically processes active campaigns daily and queues emails to all contacts in the CRM.")]),a._v(" "),e("h2",{attrs:{id:"creating-events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-events"}},[a._v("#")]),a._v(" Creating Events")]),a._v(" "),e("p",[a._v("To create an event:")]),a._v(" "),e("p",[e("strong",[a._v("Navigation:")]),e("br"),a._v(" "),e("code",[a._v("Admin Dashboard > Settings > Events")])]),a._v(" "),e("p",[a._v("The event date is used to determine when the campaign emails should be processed.")]),a._v(" "),e("h2",{attrs:{id:"creating-campaigns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-campaigns"}},[a._v("#")]),a._v(" Creating Campaigns")]),a._v(" "),e("p",[a._v("Once events are created, campaigns can be configured to send emails associated with those events.")]),a._v(" "),e("p",[e("strong",[a._v("Navigation:")]),e("br"),a._v(" "),e("code",[a._v("Admin Dashboard > Settings > Campaigns")])]),a._v(" "),e("p",[e("strong",[a._v("Required Fields:")])]),a._v(" "),e("ul",[e("li",[e("strong",[a._v("Name")]),a._v(": The name of the campaign.")]),a._v(" "),e("li",[e("strong",[a._v("Subject")]),a._v(": The subject line of the campaign email.")]),a._v(" "),e("li",[e("strong",[a._v("Event")]),a._v(": The event associated with the campaign.")]),a._v(" "),e("li",[e("strong",[a._v("Email Template")]),a._v(": The template used for the campaign email.")]),a._v(" "),e("li",[e("strong",[a._v("Status")]),a._v(": Indicates whether the campaign is active.")])]),a._v(" "),e("p",[a._v("Only active campaigns (status = 1) will be processed.")]),a._v(" "),e("h2",{attrs:{id:"email-templates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#email-templates"}},[a._v("#")]),a._v(" Email Templates")]),a._v(" "),e("p",[a._v("Before associating an email template with a campaign, templates must be created:")]),a._v(" "),e("p",[e("strong",[a._v("Navigation:")]),e("br"),a._v(" "),e("code",[a._v("Admin Dashboard > Settings > Email Templates")])]),a._v(" "),e("p",[a._v("The selected template defines the content and structure of the campaign emails.")]),a._v(" "),e("h2",{attrs:{id:"campaign-processing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#campaign-processing"}},[a._v("#")]),a._v(" Campaign Processing")]),a._v(" "),e("p",[a._v("Campaigns are processed using a custom console command. The logic filters campaigns based on the following conditions:")]),a._v(" "),e("ul",[e("li",[a._v("The campaign is marked as active.")]),a._v(" "),e("li",[a._v("The associated event is scheduled for the current date or has no date set.")])]),a._v(" "),e("p",[a._v("All email addresses from the contact list (Persons) are retrieved, and an email is queued for each.")]),a._v(" "),e("h2",{attrs:{id:"command-and-scheduling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command-and-scheduling"}},[a._v("#")]),a._v(" Command and Scheduling")]),a._v(" "),e("h3",{attrs:{id:"command-class"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command-class"}},[a._v("#")]),a._v(" Command Class")]),a._v(" "),e("p",[e("code",[a._v("Webkul\\Marketing\\Console\\Commands\\CampaignCommand")])]),a._v(" "),e("p",[e("strong",[a._v("Command Name:")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("php artisan campaign:process\n")])])]),e("p",[e("strong",[a._v("Functionality:")])]),a._v(" "),e("ul",[e("li",[a._v("Invokes the "),e("code",[a._v("process()")]),a._v(" method from "),e("code",[a._v("Webkul\\Marketing\\Helpers\\Campaign")]),a._v(".")]),a._v(" "),e("li",[a._v("Queues campaign emails for eligible campaigns and contacts.")])]),a._v(" "),e("h3",{attrs:{id:"service-provider-scheduling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-provider-scheduling"}},[a._v("#")]),a._v(" Service Provider Scheduling")]),a._v(" "),e("p",[a._v("In "),e("code",[a._v("MarketingServiceProvider")]),a._v(", the command is scheduled to run daily:")]),a._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function-definition function"}},[a._v("boot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword return-type"}},[a._v("void")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("callAfterResolving")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name static-context"}},[a._v("Schedule")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[a._v("Schedule")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$schedule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$schedule")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'campaign:process'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("daily")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),e("h2",{attrs:{id:"email-sending-logic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#email-sending-logic"}},[a._v("#")]),a._v(" Email Sending Logic")]),a._v(" "),e("h3",{attrs:{id:"location"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[a._v("#")]),a._v(" Location")]),a._v(" "),e("p",[e("code",[a._v("Webkul\\Marketing\\Helpers\\Campaign")])]),a._v(" "),e("h3",{attrs:{id:"method-process"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#method-process"}},[a._v("#")]),a._v(" Method: "),e("code",[a._v("process()")])]),a._v(" "),e("ul",[e("li",[a._v("Joins "),e("code",[a._v("marketing_campaigns")]),a._v(" with "),e("code",[a._v("marketing_events")]),a._v(" and "),e("code",[a._v("email_templates")]),a._v(".")]),a._v(" "),e("li",[a._v("Filters campaigns:\n"),e("ul",[e("li",[a._v("Status = 1 (active)")]),a._v(" "),e("li",[a._v("Event date is today or null")])])]),a._v(" "),e("li",[a._v("Retrieves all contact emails.")]),a._v(" "),e("li",[a._v("Queues emails using Laravel's queue system:")])]),a._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name static-context"}},[a._v("Mail")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("queue")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CampaignMail")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$email")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$campaign")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("h3",{attrs:{id:"method-getpersonsemails"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#method-getpersonsemails"}},[a._v("#")]),a._v(" Method: "),e("code",[a._v("getPersonsEmails()")])]),a._v(" "),e("p",[a._v("Retrieves all emails from the "),e("code",[a._v("persons")]),a._v(" repository, flattens the structure, and returns a plain array of email addresses:")]),a._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("personRepository")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("pluck")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'emails'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("flatMap")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fn")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$emails")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("collect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$emails")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("pluck")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'value'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("all")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("h2",{attrs:{id:"queue-and-scheduler-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#queue-and-scheduler-configuration"}},[a._v("#")]),a._v(" Queue and Scheduler Configuration")]),a._v(" "),e("h3",{attrs:{id:"laravel-queue"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#laravel-queue"}},[a._v("#")]),a._v(" Laravel Queue")]),a._v(" "),e("p",[a._v("Emails are queued using Laravel’s "),e("code",[a._v("queue")]),a._v(" system. Ensure that the queue worker is running:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("php artisan queue:work\n")])])]),e("p",[a._v("For production, a process manager like Supervisor is recommended to keep the queue running.")]),a._v(" "),e("h3",{attrs:{id:"laravel-scheduler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#laravel-scheduler"}},[a._v("#")]),a._v(" Laravel Scheduler")]),a._v(" "),e("p",[a._v("Ensure that the Laravel scheduler is configured to run via a cron job:")]),a._v(" "),e("p",[e("strong",[a._v("Cron Entry:")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("* * * * * php /path/to/krayin/artisan schedule:run "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),e("p",[a._v("This allows Laravel to execute scheduled tasks such as the campaign processing command.")])])}),[],!1,null,null,null);e.default=n.exports}}]);